# Cloud Terminal Dashboard Backend

FastAPI backend that powers a small “cloud terminal” dashboard. It provides mock auth, device inventory, device detail, command dispatching, and a simple log stream generated by a background simulator.

## Features

- Mock token authentication
- Device list and device detail
- Command endpoint (`RESTART`, `REFRESH_CONFIG`)
- Log streaming via polling (`after` cursor)
- Background simulation of online/offline status and log generation
- CORS enabled for local frontend development

## Requirements

- Python 3.12+

## Local Run

```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt
uvicorn app.main:app --reload
```

API will be available at `http://localhost:8000`.

OpenAPI docs:

- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`

## Docker

```bash
docker compose up --build
```

API will be available at `http://localhost:8000`.

## Authentication

All protected endpoints require:

```
Authorization: Bearer <token>
```

### Login

```bash
curl -X POST http://localhost:8000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"secret"}'
```

Response:

```json
{
  "token": "mock-...",
  "user": { "email": "test@example.com", "name": "test" }
}
```

## API Endpoints

- `POST /auth/login`
- `GET /devices`
- `GET /devices/{device_id}`
- `POST /devices/{device_id}/commands`
- `GET /devices/{device_id}/logs?after=<timestamp>`

## Examples

### List devices

```bash
curl http://localhost:8000/devices \
  -H "Authorization: Bearer <token>"
```

### Device detail

```bash
curl http://localhost:8000/devices/term-001 \
  -H "Authorization: Bearer <token>"
```

### Send command

```bash
curl -X POST http://localhost:8000/devices/term-001/commands \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"type":"RESTART"}'
```

### Poll logs

```bash
curl "http://localhost:8000/devices/term-001/logs?after=0" \
  -H "Authorization: Bearer <token>"
```
